# CKey.com Quick Start - 5 Servers in 30 Minutes

Complete quick start guide for setting up 5 servers on CKey.com and deploying your CS4445 Sub Server.

## â±ï¸ Timeline

- **5 min:** Create servers on CKey.com
- **15 min:** Configure all servers (automated)
- **5 min:** Setup GitHub secrets
- **5 min:** Deploy and verify

**Total: 30 minutes**

## ğŸ“‹ What You'll Create

```
3 Staging Servers + 2 Production Servers = 5 Total

Staging (for testing):
â”œâ”€â”€ cs4445-staging-1 â†’ IP1
â”œâ”€â”€ cs4445-staging-2 â†’ IP2
â””â”€â”€ cs4445-staging-3 â†’ IP3

Production (for live):
â”œâ”€â”€ cs4445-prod-1 â†’ IP4
â””â”€â”€ cs4445-prod-2 â†’ IP5
```

## ğŸš€ Step-by-Step Guide

### Step 1: Create Servers on CKey.com (5 minutes)

1. **Log in to CKey.com** â†’ Cloud Servers

2. **Create Staging Server 1:**
   - Click "Create Server"
   - Name: `cs4445-staging-1`
   - OS: Ubuntu 22.04 LTS
   - Size: 2 CPU, 4GB RAM, 20GB SSD
   - Region: (choose closest)
   - SSH: Add your key or use password
   - Click "Create"
   - **Note the IP:** `XXX.XXX.XXX.101`

3. **Clone the server** (or repeat Step 2):
   - Create `cs4445-staging-2` â†’ Note IP
   - Create `cs4445-staging-3` â†’ Note IP
   - Create `cs4445-prod-1` (4 CPU, 8GB RAM) â†’ Note IP
   - Create `cs4445-prod-2` (4 CPU, 8GB RAM) â†’ Note IP

4. **Document your IPs:**
   ```
   Staging: XXX.XXX.XXX.101, XXX.XXX.XXX.102, XXX.XXX.XXX.103
   Production: XXX.XXX.XXX.201, XXX.XXX.XXX.202
   ```

### Step 2: Run Automated Setup (15 minutes)

Download and run the setup script:

```bash
# Download setup script
curl -O https://raw.githubusercontent.com/YOUR_USERNAME/cs4445-sub-server/main/scripts/setup-ckey-servers.sh

# Or create it manually:
cat > setup-ckey-servers.sh << 'EOF'
#!/bin/bash
# Paste the script content from ckey-server-setup-guide.md
EOF

# Make executable
chmod +x setup-ckey-servers.sh

# Edit with your IPs and GitHub repo
nano setup-ckey-servers.sh
# Update these lines:
#   STAGING_SERVERS=("IP1" "IP2" "IP3")
#   PRODUCTION_SERVERS=("IP4" "IP5")
#   GITHUB_REPO="YOUR_USERNAME/cs4445-sub-server"

# Run the script
./setup-ckey-servers.sh
```

**The script will automatically:**
- âœ… Generate SSH deployment key
- âœ… Install Docker on all 5 servers
- âœ… Install Docker Compose on all 5 servers
- âœ… Clone your repository to all servers
- âœ… Setup SSH keys for deployment
- âœ… Configure firewall rules
- âœ… Create .env files

**Wait for:** `âœ… All servers configured successfully!`

### Step 3: Add GitHub Secrets (5 minutes)

```bash
# Install GitHub CLI (if not installed)
# Ubuntu/Debian: sudo apt install gh
# Mac: brew install gh
# Windows: winget install GitHub.cli

# Login to GitHub
gh auth login

# Add server IPs (use YOUR actual IPs)
gh secret set STAGING_SERVER_IPS -b "XXX.XXX.XXX.101,XXX.XXX.XXX.102,XXX.XXX.XXX.103"
gh secret set PRODUCTION_SERVER_IPS -b "XXX.XXX.XXX.201,XXX.XXX.XXX.202"

# Add deployment configuration
gh secret set DEPLOY_USER -b "ubuntu"
gh secret set DEPLOY_PATH -b "/app/cs4445-sub-server"

# Add SSH private key (generated by setup script)
gh secret set DEPLOY_SSH_KEY < ~/.ssh/ckey-deploy

# Verify all secrets are added
gh secret list
```

Expected output:
```
DEPLOY_SSH_KEY         Updated YYYY-MM-DD
DEPLOY_USER           Updated YYYY-MM-DD
DEPLOY_PATH           Updated YYYY-MM-DD
STAGING_SERVER_IPS    Updated YYYY-MM-DD
PRODUCTION_SERVER_IPS Updated YYYY-MM-DD
```

### Step 4: Deploy and Verify (5 minutes)

```bash
# Test SSH to all servers
for ip in XXX.XXX.XXX.{101..103} XXX.XXX.XXX.{201..202}; do
    ssh -i ~/.ssh/ckey-deploy ubuntu@$ip "echo 'âœ“ $ip connected'"
done

# Deploy to staging servers
git add .
git commit -m "Initial CKey.com deployment"
git push origin main
```

**Watch deployment in GitHub Actions:**
1. Go to: https://github.com/YOUR_USERNAME/cs4445-sub-server/actions
2. Click on running workflow
3. Watch: "Deploy to Staging Servers" job
4. Expected:
   ```
   ğŸš€ Starting parallel deployment to 3 staging servers...
   âœ… All servers deployed and healthy
   ```

**Verify deployment:**
```bash
# Check health on all staging servers
for ip in XXX.XXX.XXX.{101..103}; do
    echo "Server $ip:"
    curl http://$ip:8080/actuator/health
done
```

**Access Grafana dashboards:**
- Staging 1: http://XXX.XXX.XXX.101:3000 (admin/admin)
- Staging 2: http://XXX.XXX.XXX.102:3000
- Staging 3: http://XXX.XXX.XXX.103:3000

## âœ… Success Checklist

- [ ] 5 servers created on CKey.com
- [ ] All server IPs documented
- [ ] Setup script completed successfully
- [ ] GitHub secrets added
- [ ] SSH test passed for all servers
- [ ] Deployment to staging succeeded
- [ ] Health checks passed for all servers
- [ ] Grafana dashboards accessible

## ğŸ¯ What You Can Do Now

### Test the Application

```bash
# Send test requests to all servers
for ip in XXX.XXX.XXX.{101..103}; do
    echo "Testing $ip..."
    curl -X POST http://$ip:8080/api/v1/fakePacket \
        -H "Content-Type: application/json" \
        -d '{"packetId":"test","cpuIntensity":5,"ramIntensity":5}'
done
```

### Deploy to Production

```bash
# Create version tag
git tag v1.0.0
git push origin v1.0.0

# This will:
# 1. Deploy to staging first
# 2. Then deploy to production (2 servers) with blue-green strategy
# 3. Zero downtime deployment!
```

### Monitor All Servers

```bash
# Create monitoring script
cat > check-all.sh << 'EOF'
#!/bin/bash
for ip in XXX.XXX.XXX.{101..103}; do
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    echo "Server: $ip"
    echo "Health: $(curl -s http://$ip:8080/actuator/health | jq -r .status)"
    echo "Status: $(curl -s http://$ip:8080/api/v1/server/status | jq -r .status)"
done
EOF
chmod +x check-all.sh
./check-all.sh
```

## ğŸ”§ Troubleshooting

### Can't SSH to servers?

```bash
# Check on CKey.com dashboard:
# 1. Server is running (green status)
# 2. Firewall allows port 22
# 3. Public IP is correct

# Try with password first
ssh ubuntu@XXX.XXX.XXX.101

# Then add SSH key
ssh-copy-id -i ~/.ssh/ckey-deploy.pub ubuntu@XXX.XXX.XXX.101
```

### Setup script fails?

```bash
# Run manually on each server:
ssh ubuntu@XXX.XXX.XXX.101

# Install Docker
curl -fsSL https://get.docker.com | sudo sh
sudo usermod -aG docker ubuntu

# Install Docker Compose
sudo curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose

# Clone repo
sudo mkdir -p /app && sudo chown ubuntu:ubuntu /app
cd /app
git clone https://github.com/YOUR_USERNAME/cs4445-sub-server.git
```

### Deployment fails?

```bash
# Check logs on failed server
ssh ubuntu@XXX.XXX.XXX.101
docker logs cs4445-app --tail 100

# Manually deploy to that server
./scripts/deploy-to-server.sh \
    XXX.XXX.XXX.101 \
    ubuntu \
    /app/cs4445-sub-server \
    main \
    staging
```

### Health check fails?

```bash
# Check if app is running
ssh ubuntu@XXX.XXX.XXX.101 "docker ps"

# Check firewall
ssh ubuntu@XXX.XXX.XXX.101 "sudo ufw status"
# Add rule if needed:
ssh ubuntu@XXX.XXX.XXX.101 "sudo ufw allow 8080/tcp"

# Check from CKey dashboard
# Security â†’ Firewall â†’ Allow port 8080
```

## ğŸ“– Next Steps

1. **Read full guide:** `docs/ckey-server-setup-guide.md`
2. **Deployment strategies:** `docs/multi-server-deployment-guide-v2.md`
3. **GitHub runners:** `docs/github-runner-setup-guide-v2.md` (optional)

## ğŸ’° Cost Optimization Tips for CKey.com

1. **Stop staging servers when not in use:**
   - CKey dashboard â†’ Server â†’ Power â†’ Stop
   - Restart when needed (data is preserved)

2. **Use snapshots:**
   - Create snapshot after initial setup
   - Quickly create new servers from snapshot

3. **Right-size servers:**
   - Start with smaller instances
   - Upgrade only if needed

4. **Monitor usage:**
   - Check server metrics on CKey dashboard
   - Scale down if underutilized

## ğŸ‰ Congratulations!

You now have:
- âœ… 5 servers on CKey.com
- âœ… Automated deployment pipeline
- âœ… Multi-server deployment working
- âœ… Monitoring dashboards
- âœ… Production-ready setup

**Total setup time:** ~30 minutes
**Servers:** 3 staging + 2 production
**Deployment:** Fully automated

**You're ready to deploy at scale!** ğŸš€

---

**Quick Reference:**

| What | Command |
|------|---------|
| SSH to server | `ssh -i ~/.ssh/ckey-deploy ubuntu@IP` |
| Deploy staging | `git push origin main` |
| Deploy production | `git tag v1.0.0 && git push origin v1.0.0` |
| Check all servers | `./check-all.sh` |
| View Grafana | `http://SERVER_IP:3000` |
| View app | `http://SERVER_IP:8080` |

**Support:** See `docs/ckey-server-setup-guide.md` for detailed troubleshooting
